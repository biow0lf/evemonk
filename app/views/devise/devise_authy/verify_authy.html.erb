<div class="row">
  <div class="col">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to("Home", root_path) %></li>
        <li class="breadcrumb-item active" aria-current="page"><%= t("devise.submit_token_title") %></li>
      </ol>
    </nav>
  </div>
</div>

<%= verify_authy_form do %>
  <legend><%= t("devise.submit_token_title") %></legend>
  <%= label_tag "authy-token" %>
  <%= text_field_tag :token, "", autocomplete: :off, id: "authy-token" %>
  <label>
    <%= check_box_tag :remember_device %>
    <span><%= t("devise.remember_device") %></span>
  </label>

  <!-- Help tooltip -->
  <!-- You need to configure a help message. -->
  <!-- See documentation: https://github.com/authy/authy-form-helpers#help-tooltip -->
  <!-- <%= link_to '?', '#', :id => 'authy-help' %> -->

  <%= authy_request_sms_link %>
  <%= submit_tag t("devise.submit_token"), class: "btn" %>
<% end %>

<% if @onetouch_uuid %>
    <script>
      (function(){
        var onetouchInterval = setInterval(function(){
          var onetouchRequest = new XMLHttpRequest();
          onetouchRequest.addEventListener("load", function(){
            if(this.status !== 202) clearInterval(onetouchInterval);
            if(this.status === 200) window.location = JSON.parse(this.responseText).redirect;
          });
          onetouchRequest.open("GET", "<%= polymorphic_path [resource_name, :authy_onetouch_status] %>?onetouch_uuid=<%= @onetouch_uuid %>");
          onetouchRequest.send();
        }, 3000);
      })();
    </script>
<% end %>
